<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	
		<link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
	
		<link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
	
		<link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
	

	<link rel="stylesheet" href="../_static/css/style.css" />
	<script src="../_static/js/modernizr.js"></script>
	<link href='http://fonts.googleapis.com/css?family=PT+Serif:400,700' rel='stylesheet' type='text/css'>

	
		<title>Extending the Vehicle-Log Model</title>
	

	<script type="text/javascript">
		var DOCUMENTATION_OPTIONS = {
			URL_ROOT: '',
			VERSION: '0.5',
			COLLAPSE_INDEX: false,
			FILE_SUFFIX: '.html',
			HAS_SOURCE: true
		};
	</script>

</head>
<body>
	<nav id="topnav" class="navbar navbar-default navbar-fixed-top" role="navigation">
		<div class="container-fluid">
			<div class="navbar-header">
				<button class="navbar-toggle collapsed icon-facebook-sign" type="button" data-toggle="collapse" data-target="#collapsable-topnav">
					<i class="fa fa-bars"></i>
				</button>
				<a class="navbar-brand" href="http://dronekit.io/">
					<img src="../_static/images/new-DK-logo-color.svg" alt="3DR">
				</a>
			</div>
			<div class="navbar-collapse collapse" id="collapsable-topnav">
				<ul class="nav navbar-nav navbar-right">
					<li>
						<a href="https://cloud.dronekit.io/" class="cloud">Cloud</a>
					</li>
					<li>
						<a href="http://python.dronekit.io/" class="air">Python</a>
					</li>
					<li>
						<a href="http://android.dronekit.io/" class="ground">Android</a>
					</li>
					<li>
						<a href="http://dronekit.io/support" class="support">Support</a>
					</li>
				</ul>
			</div>
		</div>
	</nav>

	<div class="container-fluid">
		<div class="row gray-bg">
			<div class="col-sm-3 col-md-2 col-sidebar">

        
					
	<div id="sidebar-search" role="search">
		<form id="rtd-search-form" class="form-inline" action="../search.html" method="get">
			<div class="input-group">
				<span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>
				<input class="form-control" type="text" name="q" placeholder="Search..." />
			</div>
			<input type="hidden" name="check_keywords" value="yes" />
			<input type="hidden" name="area" value="default" />
		</form>
	</div>
        
				<div id="gray-sidebar" class="container-fluid">
	        
	          
	          
	              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about/about.html">About</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../about/about.html#key-features">Key features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/about.html#how-does-it-work">How does it work?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/about.html#comparison-to-loganalyzer-py">Comparison to LogAnalyzer.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/about.html#open-source-community">Open source community</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/about.html#technical-support">Technical support</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../guide/getting_started.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../guide/getting_started.html#installing">Installing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guide/getting_started.html#running-the-tool">Running the tool</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../guide/getting_started.html#specifying-frame-and-model-type">Specifying frame and model type</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../guide/getting_started.html#interpreting-the-output">Interpreting the output</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../guide/getting_started.html#json-output">JSON output</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guide/getting_started.html#brief">Brief</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guide/getting_started.html#plain-text-output">Plain text output</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../guide/other_features.html">Other Features</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../guide/other_features.html#taking-input-from-stdin">Taking input from STDIN</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guide/other_features.html#selecting-analyzers">Selecting analyzers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guide/other_features.html#use-a-config-file">Use a config file</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/analyzers.html">Analyzer List</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/analyzers.html#any-parameters-seen">Any Parameters Seen</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/analyzers.html#altitude-estimate-divergence">Altitude Estimate Divergence</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/analyzers.html#arming-checks">Arming Checks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/analyzers.html#attitude-control">Attitude Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/analyzers.html#attitude-estimate-divergence">Attitude Estimate Divergence</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/analyzers.html#autopilot-health">AutoPilot Health</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/analyzers.html#battery">Battery</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/analyzers.html#compass-offsets">Compass Offsets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/analyzers.html#compass-vector-length">Compass Vector Length</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/analyzers.html#crash-test">Crash Test</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/analyzers.html#ever-armed">Ever Armed</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/analyzers.html#ever-flew">Ever Flew</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/analyzers.html#good-ekf">Good EKF</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/analyzers.html#gps-fix">GPS Fix</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/analyzers.html#gyro-drift">Gyro Drift</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/analyzers.html#position-estimate-divergence">Position Estimate Divergence</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/analyzers.html#sensor-health">Sensor Health</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/analyzers.html#truncated-log">Truncated Log</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/analyzers.html#vehicle-definition">Vehicle Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/analyzers.html#velocity-estimate-divergence">Velocity Estimate Divergence</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/command_line_reference.html">Command Line Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/command_line_reference.html#command-syntax">Command Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/command_line_reference.html#options">Options</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Contributing</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="contribution_tool.html">Contributing to DroneKit-LA</a><ul>
<li class="toctree-l3"><a class="reference internal" href="contribution_tool.html#submitting-changes">Submitting changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="contribution_tool.html#building-the-tool">Building the Tool</a><ul>
<li class="toctree-l4"><a class="reference internal" href="contribution_tool.html#building-using-vagrant">Building using Vagrant</a></li>
<li class="toctree-l4"><a class="reference internal" href="contribution_tool.html#building-on-linux">Building on Linux</a></li>
<li class="toctree-l4"><a class="reference internal" href="contribution_tool.html#building-on-mac-osx">Building on Mac OSX</a></li>
<li class="toctree-l4"><a class="reference internal" href="contribution_tool.html#building-on-windows">Building on Windows</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="contribution_tool.html#testing-changes">Testing changes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="contribution_docs.html">Contributing to the Documentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="contribution_docs.html#submitting-changes">Submitting changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="contribution_docs.html#building-the-docs">Building the docs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="contribution_docs.html#the-easy-way-vagrant">The easy way (Vagrant)</a></li>
<li class="toctree-l4"><a class="reference internal" href="contribution_docs.html#building-docs-on-native-os">Building docs on native OS</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="contribution_docs.html#tracking-todo-items">Tracking todo items</a></li>
<li class="toctree-l3"><a class="reference internal" href="contribution_docs.html#style-guide">Style guide</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="developer_setup_vagrant.html">Building DroneKit-LA in Vagrant</a><ul>
<li class="toctree-l3"><a class="reference internal" href="developer_setup_vagrant.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="developer_setup_vagrant.html#building-the-dronekit-la-tool">Building the DroneKit-LA Tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="developer_setup_vagrant.html#building-the-documentation-in-vagrant">Building the Documentation in Vagrant</a></li>
<li class="toctree-l3"><a class="reference internal" href="developer_setup_vagrant.html#closing-and-re-using-the-vm">Closing and re-using the VM</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="add_analyzer.html">Adding a New Analyzer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="add_analyzer.html#framework-overview">Framework overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="add_analyzer.html#creating-an-analyzer">Creating an Analyzer</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Extending the Vehicle-Log Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/analyser_reference.html">Analyzer Class Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/analyser_reference.html#analyzer">Analyzer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/analyser_reference.html#result-classes">Result Classes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/analyser_reference.html#vehicle-model">Vehicle Model</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/message_handlers_reference.html">Message Handler Class Reference</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../about/license.html">License</a></li>
</ul>

	          
	        
				</div>
			</div>
			<div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
				<div id="api-content">
					
  <div class="section" id="extending-the-vehicle-log-model">
<span id="message-handler-top"></span><h1>Extending the Vehicle-Log Model<a class="headerlink" href="#extending-the-vehicle-log-model" title="Permalink to this headline">¶</a></h1>
<p>The vehicle “log model” class (<code class="docutils literal notranslate"><span class="pre">AnalyzerVehicle::Base</span></code>) provides a common model for analyzers to query
log information, independent of the original log format.</p>
<p>This class exposes a subset of information from the original logs. If a new analyzer needs
information that is not present in the model (but which was present in the original logs) then the
model must be extended.</p>
<p>This process has three parts:</p>
<ol class="arabic">
<li><p>Extend <a class="reference internal" href="../reference/analyser_reference.html#_CPPv4N15AnalyzerVehicle4BaseE" title="AnalyzerVehicle::Base"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">AnalyzerVehicle::Base</span></code></a> with members and functions that are appropriate for capturing the
desired information and series of information. If you can infer useful vehicle-specific information
from a  message add it to the vehicle specific classes in the <code class="docutils literal notranslate"><span class="pre">AnalyzerVehicle</span></code> namespace (e.g. <a class="reference internal" href="../reference/analyser_reference.html#_CPPv4N15AnalyzerVehicle6CopterE" title="AnalyzerVehicle::Copter"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Copter</span></code></a>).</p></li>
<li><p>Add a message type handler for the desired message in the dataflash log. This will populate the vehicle
model appropriately and add data sources that can later be referenced by analyzers for the output:</p>
<ul>
<li><p>Declare a handler class for the desired message type in
<a class="reference external" href="https://github.com/dronekit/dronekit-la/blob/master/LA_MsgHandler.h">LA_MsgHandler.h</a>.</p>
<p>This should be derived from <a class="reference internal" href="../reference/message_handlers_reference.html#_CPPv413LA_MsgHandler" title="LA_MsgHandler"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">LA_MsgHandler</span></code></a> and implement the pure virtual method <a class="reference internal" href="../reference/message_handlers_reference.html#_CPPv4N13LA_MsgHandler8xprocessEPK7uint8_t" title="LA_MsgHandler::xprocess"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">LA_MsgHandler::xprocess()</span></code></a> (where you process the message and update the vehicle).</p>
<p>The handler should also add “data sources” to its (inherited) <code class="docutils literal notranslate"><span class="pre">_analyze</span></code> variable using <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">Analyze::add_data_source()</span></code>.
Each source would have a name used to reference the source in analyzers, and another string indicating
associated the message type and field. For example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">_analyze</span><span class="o">-&gt;</span><span class="n">add_data_source</span><span class="p">(</span><span class="s">&quot;EKF_FLAGS&quot;</span><span class="p">,</span> <span class="s">&quot;EKF4.SS&quot;</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>Create an instance of the handler and pass a message to it in
<code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">Analyzing_DataFlash_Message_Handler::handle_format_message_received()</span></code>.</p></li>
</ul>
</li>
<li><p>Add a message type handler for the same message in tlogs. This also populates the vehicle model
appropriately and adds data sources that can later be referenced by analyzers for the output (though
the structure of code is quite different):</p>
<ul class="simple">
<li><p>Update <a class="reference external" href="https://github.com/dronekit/dronekit-la/blob/master/mavlink_message_handler.h">MAVLink_Message_Handler</a> and
<a class="reference external" href="https://github.com/dronekit/dronekit-la/blob/master/analyzing_mavlink_message_handler.h">Analyzing_MAVLink_Message_Handler</a>
with virtual <code class="docutils literal notranslate"><span class="pre">handle_decoded_message()</span></code> methods (and implementations). As before set the data sources for the processed messages.</p></li>
</ul>
</li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The above process may seem confusing, but there are lots of good examples in the linked source!</p>
</div>
</div>


					<footer id="footer">
						
	<div class="footer-buttons" role="navigation" aria-label="footer navigation">
		
			<a href="../reference/analyser_reference.html" class="btn btn-default pull-right" title="Analyzer Class Reference">
				Next <span class="fa fa-arrow-circle-right"></span>
			</a>
		
		
			<a href="add_analyzer.html" class="btn btn-default" title="Adding a New Analyzer">
				<span class="fa fa-arrow-circle-left"></span> Previous
			</a>
		
	</div>


<hr/>

<div role="contentinfo">
	<p>
				&copy; Copyright 2015-2016, 3D Robotics.
	</p>
</div>
Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/3drobotics/sphinx_3dr_theme">theme</a> provided by <a href="https://3drobotics.com">3D Robotics</a> for <a href="http://dronekit.io">DroneKit</a>.
					</footer>
				</div>
			</div>
		</div>
	</div>

	
		<script type="text/javascript" src="../_static/js/jquery.js"></script>
		<script type="text/javascript" src="../_static/js/scroll.js"></script>
		<script type="text/javascript" src="../_static/underscore.js"></script>
		<script type="text/javascript" src="../_static/doctools.js"></script>
		<script type="text/javascript" src="../_static/js/bootstrap.js"></script>
		<script type="text/javascript" src="../_static/js/cool-select.js"></script>
		<script type="text/javascript" src="../_static/searchtools.js"></script>
	
	<script type="text/javascript">
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-39974306-3', 'auto');
		ga('send', 'pageview');
	</script>
</body>
</html>